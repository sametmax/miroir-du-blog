<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Sam &#38; Max &#187; framework</title>
	<atom:link href="http://sametmax.com/tag/framework/feed/" rel="self" type="application/rss+xml" />
	<link>http://sametmax.com</link>
	<description>Du code, du cul</description>
	<lastBuildDate>Sat, 07 Nov 2015 10:56:13 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=4.1</generator>
	<item>
		<title>The User is dead 18</title>
		<link>http://sametmax.com/the-user-is-dead/</link>
		<comments>http://sametmax.com/the-user-is-dead/#comments</comments>
		<pubDate>Tue, 14 Jul 2015 12:27:42 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Philo et culture]]></category>
		<category><![CDATA[authentication]]></category>
		<category><![CDATA[django]]></category>
		<category><![CDATA[framework]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=16615</guid>
		<description><![CDATA[L&#8217;authentification de mémé (enfin, mémé&#8230;) n&#8217;a plus de sens, et pourtant, on continue de la montrer en exemple dans tous les tutos : Un compte utilisateur. Un email. Un mot de passe. Boom, on vérifie le mot de passe (avec un peu de chance sur une version sainement hachée), on identifie l&#8217;utilisateur, et c&#8217;est plié. [&#8230;]]]></description>
				<content:encoded><![CDATA[<p>L&#8217;authentification de mémé (enfin, mémé&#8230;) n&#8217;a plus de sens, et pourtant, on continue de la montrer en exemple dans tous les tutos :</p>
<ul>
<li>Un compte utilisateur.</li>
<li>Un email.</li>
<li>Un mot de passe.</li>
</ul>
<p>Boom, on vérifie le mot de passe (avec un peu de chance sur une version sainement hachée), on identifie l&#8217;utilisateur, et c&#8217;est plié.</p>
<p>C&#8217;est simple, c&#8217;est beau, ça marche.</p>
<p>Mais ça ne représente pas du tout la réalité.</p>
<p>Une des plus grosses erreurs de design de frameworks comme Django est justement la classe <code>User</code>.</p>
<p>En soit, la classe <code>User</code> n&#8217;est pas un problème, mais son omniprésence dans toutes les couches du framework et sa promotion au rang d&#8217;unité de référence dans les apps tierces parties ont gardé la vision de l&#8217;authentification très monolithique.</p>
<p>C&#8217;est que le Web n&#8217;a plus du tout la forme qu&#8217;il avait il y a 10 ans, et aujourd&#8217;hui, vous pouvez vous connecter via un service (facebook, twitter, github&#8230;), utiliser une authentification à double facteur (sms, email, yubikey&#8230;) ou avoir un compte unique qui unifie plusieurs fournisseurs (ah, le fameux compte Google qui fait gmail, youtube, calendar, play, saucisseland&#8230;).</p>
<p>Les gens ont plusieurs identités, plusieurs comptes, plusieurs modes d&#8217;authentification, plusieurs points d&#8217;entrées. Ce modèle ne marche plus :</p>
<pre>USER <-- Profile </pre>
<p>Si vous créez un service aujourd'hui et que vous souhaitez prendre en compte cette réalité, le schéma en base de données va plutôt ressembler à un truc du genre :</p>
<pre>                      +-------+
                      |Session|
                      +----+--+
                           |
                           |
                           |
                           |
+-----------+         +----v---+         +--------+
|  Identity | <-------+ Account| <-------+Profile |
+-----------+         +--------+         +--------+
                 +------^   ^--------+
                 |                   |
                 |                   |
                 |                   |
                 |                   |
         +-------+-----+      +------+----+
         | Credential  |      |  Service  |
         +-------------+      +-----------+
</pre>
<p>Et encore, je n'ai pas mis les permissions, les devices, les comptes multi-utilisateurs, la vérification des comptes (lien email, sms, etc), les niveaux d'offre commerciale... Ca rend le truc vraiment compliqué.</p>
<p>Ce qui est important ici, c'est que la notion de compte devient centrale, mais que seule l'identité est unique. Une identité peut avoir plusieurs comptes. Et un compte peut être chez votre service ou un service externe. Et l'authentification peut très bien avoir lieu ailleurs : ldap, OAuth, Mozilla Personna, Open ID...</p>
<p>Si votre utilisateur a un compte chez Facebook et un compte chez vous, les deux sont des comptes, avec leurs profils, reliés à la même identité, servant à vous donner des informations, permettant de se loguer... Et vous devez garder une trace de tout ça. Le fait que l'API d'un service tape sur votre serveur et l'autre non n'a en fait aucune importance pour l'utilisateur, qui utilise tout ça comme un gros blob comme si internet était un tout.</p>
<p>La nouvelle génération ne fait pas la différence avec un site Web et un app, ne sait pas ce qu'est une URL ou un cookie et ne veut pas rentrer trop de mots de passe, mais veut par contre utiliser 5000 services.</p>
<p>Ainsi on voit que les archis basées sur des microservices (hello crossbar :)) commencent à avoir la côte, faisant abstraction de la notion de "ceci est mon app, ceci est ton app" dans la structure de son projet. Bien entendu, la distinction est importante d'un point de vue humain, mais du point de vue du workflow d'authentification, non.</p>
<p>Par contre, forcément, ça fait beaucoup plus qu'une table <code>User</code> et une table <code>Profile</code> en base de données, et c'est pourquoi toutes les apps pluggables des frameworks actuellement ont leurs propres structures bizarres, incompatibles et torturées pour faire tenir toute cette logique. Parce qu'on code sur des frameworks qui vivent encore dans les années 2000, qui passent à votre vue un objet <code>User</code> en paramètre avec ses attributs <code>username</code> et <code>email</code>.</p>
<p>Mais ce que vous avez en face de vous, ce n'est pas un utilisateur.</p>
<p>C'est une session d'utilisation.</p>
<p>D'un service (le votre). Liée à un compte. Qui peut-être (surement) possède un profil avec un username.</p>
<p>Cette session s'est initiée par une authentification avec une méthode parmi 100 auprès d'un service également, lié à un compte, avec un profil. Peut-être le même service que celui qui est utilisé, peut-être pas.</p>
<p>Et cette authentification a pu être demandée par un utilisateur, ou encore un autre service, ou un logiciel client complètement automatiquement. Souvenez-vous : la session n'a peut-être aucun humain derrière.</p>
<p>Ce qui est en face de vous n'est pas un utilisateur. L'utilisateur est mort il y a des années.</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/the-user-is-dead/feed/</wfw:commentRss>
		<slash:comments>18</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2015/07/Qokothr.jpg" length="88567" type="image/jpg" />	</item>
		<item>
		<title>Est-ce que &#8220;framework x&#8221; supporte la charge ? 16</title>
		<link>http://sametmax.com/est-ce-que-framework-x-supporte-la-charge/</link>
		<comments>http://sametmax.com/est-ce-que-framework-x-supporte-la-charge/#comments</comments>
		<pubDate>Tue, 24 Dec 2013 21:08:05 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[framework]]></category>
		<category><![CDATA[perf]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=7754</guid>
		<description><![CDATA[Wait for it...]]></description>
				<content:encoded><![CDATA[<p style="text-align:center;">Oui.</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/est-ce-que-framework-x-supporte-la-charge/feed/</wfw:commentRss>
		<slash:comments>16</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2013/12/tumblr_myb66fg4XQ1r539hzo1_500.jpg" length="71544" type="image/jpg" />	</item>
		<item>
		<title>Le bonheur des frameworks 13</title>
		<link>http://sametmax.com/le-bonheur-des-frameworks/</link>
		<comments>http://sametmax.com/le-bonheur-des-frameworks/#comments</comments>
		<pubDate>Mon, 17 Dec 2012 13:37:58 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Philo et culture]]></category>
		<category><![CDATA[framework]]></category>
		<category><![CDATA[java]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=3709</guid>
		<description><![CDATA[Traduction un peu adaptée de l'article Why I hate framework de Joel Spolsky]]></description>
				<content:encoded><![CDATA[<p style="text-align: center;"><em>Traduction un peu adaptée de l&#8217;article <a href="http://discuss.joelonsoftware.com/default.asp?joel.3.219431">Why I hate framework</a> de Joel Spolsky</em></p>
<p style="text-align: left;">J&#8217;ai voulu construire une petite étagère pour y ranger les condiments.</p>
<p>Ayant fait un peu de menuiserie avant, j&#8217;avais une bonne idée de ce dont j&#8217;avais besoin : un peu de bois et quelques outils de base. Un mètre, une scie, un niveau et un marteau.</p>
<p>D&#8217;ailleurs, si je voulais construire toute une maison, j&#8217;en aurais besoin également. Du coup je suis allé dans une quincaillerie, et j&#8217;ai demandé au vendeur où je pouvais trouver un marteau.</p>
<p>&#8220;- Un marteau ?&#8221;, me répondit-il. &#8220;Plus personne n&#8217;achète des marteaux de nos jours vous savez. Ils sont un peu vieux jeu.&#8221;</p>
<p>Surpris, je lui demande pourquoi.</p>
<p>&#8211; &#8220;Et bien, le problème avec les marteaux, c&#8217;est qu&#8217;il y en a plein de différents types. Des marteaux arrache-clou, des masses, des marteaux de tapissier&#8230; Que se passerait-il si vous achetiez un type de marteau et réalisiez que vous avez besoin d&#8217;un autre type plus tard ? Vous devriez achetez un autre marteau pour votre prochaine tâche. Il se trouve que la plupart des gens veulent vraiment un seul marteau qui peut être utilisé pour la majorité des tâches qu&#8217;ils peuvent rencontrer dans leur vie.&#8221;</p>
<p>&#8211; &#8220;Ça me parait logique. Pouvez-vous me dire où je peux trouver un marteau universel ?&#8221;</p>
<p>&#8211; &#8220;Non, nous ne les vendons plus. Ils sont obsolètes.&#8221;</p>
<p>&#8211; &#8220;Vraiment ? Je pensais que vous veniez de dire que le marteau universel était l&#8217;avenir.&#8221;</p>
<p>&#8211; &#8220;Il se trouve que, si vous faites un seul marteau qui puisse être utilisé pour toutes sortes de tâches, il n&#8217;est vraiment bon, à aucune d&#8217;entre elles. Enfoncer un clou avec une masse n&#8217;est pas très efficace. Et pour tuer votre petite amie, rien ne vaut un marteau de tapissier.&#8221;</p>
<p>&#8211; &#8220;C&#8217;est clair ! Donc, si plus personne n&#8217;achète des marteaux universels, et que vous ne vendez plus de marteaux à l&#8217;ancienne, quels marteaux vendez-vous ?&#8221;</p>
<p>&#8211; &#8220;En fait, nous n&#8217;en vendons pas.&#8221;</p>
<p>&#8211; &#8220;Alors&#8230;&#8221;</p>
<p>&#8211; &#8220;D&#8217;après nos recherches, ce dont les gens ont besoin n&#8217;est pas un marteau universel du tout. Il vaut toujours mieux avoir le bon marteau pour le bon boulot. Donc, nous avons commencé à vendre des fabriques de marteau, capable de produire n&#8217;importe quel marteau qui pourrait vous intéresser. Tout ce dont vous avez besoin est de remplir la fabrique de travailleurs, lancer la machinerie, acheter les matériaux de base, payer les charges et hop, vous avez *exactement* le type de marteau dont vous avez besoin en un clin d’œil.&#8221;</p>
<p>&#8211; &#8220;Mais je ne veux pas acheter une fabrique de marteaux&#8230;&#8221;</p>
<p>&#8211; &#8220;Parfait. Car nous n&#8217;en vendons plus.&#8221;</p>
<p>&#8211; &#8220;Attendez, vous venez de me dire que&#8230;&#8221;</p>
<p>&#8211; &#8220;Nous avons découvert que la plupart des gens n&#8217;ont pas besoin d&#8217;une fabrique complète de marteaux. Certains, par exemple, n&#8217;auront jamais besoin d&#8217;un marteau de tapissier. (Peut être qu&#8217;ils n&#8217;ont pas d&#8217;ex. Ou peut être qu&#8217;ils les ont tué avec des pics à glace.). Donc il n&#8217;y a aucune raison pour quelqu&#8217;un d&#8217;acheter une fabrique de marteaux pour tous les types de marteaux.&#8221;</p>
<p>&#8211; &#8220;Oui, c&#8217;est sûr.&#8221;</p>
<p>&#8211; &#8220;Donc, à la place, on a commencé à vendre les plans de constructions de la fabrique de marteaux, afin que nos clients puissent construire leurs propres fabriques, complètement personnalisées pour produire uniquement les types de marteaux dont ils ont besoin.&#8221;</p>
<p>&#8211; &#8220;Laissez-moi deviner. Vous ne les vendez plus.&#8221;</p>
<p>&#8211; &#8220;Non. Bien entendu. Il se trouve que les gens ne veulent pas construire toute une fabrique juste pour faire quelques marteaux. Laissez la construction des fabriques aux experts de construction de fabriques, c&#8217;est ce que je dis toujours !!&#8221;</p>
<p>&#8211; &#8220;Et je vous approuve sur ce point.&#8221;</p>
<p>&#8211; &#8220;Et oui. Donc nous avons arrêté de vendre ces plans et nous avons commencé à vendre des fabriques de fabriques de marteaux. Chacune d&#8217;elle est construite par nos experts dans le business de fabrique de fabrique de marteaux, afin que vous n&#8217;ayez pas à vous inquiéter des détails triviaux de la construction d&#8217;une fabrique. Malgré cela, vous avez tous les bénéfices d&#8217;avoir votre propre fabrique personnalisée, produisant vos propres marteaux personnalisés, collant à vos designs spécifiques en matière de marteau.&#8221;</p>
<p>&#8211; &#8220;Heu, ça ne me semble pas vraiment&#8230;&#8221;</p>
<p>&#8211; &#8220;Je sais ce que vous allez dire !! &#8230; et nous ne les vendons d&#8217;ailleurs plus. Apparemment, peu de gens achetaient ces fabriques de fabrique de marteaux, donc nous avons trouvé une solution à ce problème.&#8221;</p>
<p>&#8211; &#8220;Hum.&#8221;</p>
<p>&#8211; &#8220;Nous avons pris le temps de faire le bilan de notre infrastructure technique, et nous avons déterminé que les gens développaient une frustration à avoir à gérer et opérer une fabrique de fabrique de marteaux, tout comme la fabrique qu&#8217;elle produisait. Ce genre de contrainte additionnelle peut se révéler fastidieux quand vous vous retrouvez dans un scénario où vous utilisez également une fabrique de fabrique de mètres, une fabrique de fabrique de scies et une fabrique de fabrique de niveaux. Sans compter un conglomérat de transformation du bois. Nous avons objectivement évalué la situation, et déterminé que c&#8217;était trop complexe pour quelqu&#8217;un qui voulait juste créer une étagère pour condiments&#8221;.</p>
<p>&#8211; &#8220;Non, sans blague ?&#8221;</p>
<p>&#8211; &#8220;Du coup cette semaine, nous mettons sur le marché une fabrique de fabrique de fabrique de création d&#8217;outils en tout genre, pour qu&#8217;ainsi vos différentes fabriques de fabrique à outils puissent être créées à partir d&#8217;une seule fabrique unifiée. La fabrique de fabrique de fabrique produira uniquement la fabrique de fabrique dont vous avez réellement besoin, et ainsi ces fabriques de fabrique produiront une seule fabrique basée sur vos spécifications d&#8217;outils personnalisés. Vous aurez *exactement* le marteau dont vous avez besoin, et exactement le bon mètre pour votre tâche, juste en appuyant sur un bouton (même si vous aurez probablement quelques fichiers de configuration pour que tout fonctionne selon vos attentes).</p>
<p>&#8211; &#8220;Donc, vous n&#8217;avez pas de marteaux ? Pas du tout ?&#8221;</p>
<p>&#8211; &#8220;Non. Si vous voulez vraiment une étagère à condiments de haute qualité, de standard industriel, vous avez vraiment besoin de quelque chose de plus sophistiqué qu&#8217;un simple marteau acheté à la quincaillerie du coin.&#8221;</p>
<p>&#8211; &#8220;Ok&#8230; Bon. Il faut ce qu&#8217;il faut. Si c&#8217;est comme ça qu&#8217;on fait maintenant, il faut bien que je m&#8217;y mette.&#8221;</p>
<p>&#8211; &#8220;Excellent !!&#8221;</p>
<p>&#8211; &#8220;Ça vient avec une documentation, pas vrai ?&#8221;</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/le-bonheur-des-frameworks/feed/</wfw:commentRss>
		<slash:comments>13</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2012/12/250px-Hammer_tapissier.jpg" length="10005" type="image/jpg" />	</item>
		<item>
		<title>Créer un site avec bottle en 5 minutes (parceque 7 c&#8217;est impossible voyons !) 17</title>
		<link>http://sametmax.com/creer-un-site-avec-bottle-en-5-minutes-parceque-7-cest-impossible-voyons/</link>
		<comments>http://sametmax.com/creer-un-site-avec-bottle-en-5-minutes-parceque-7-cest-impossible-voyons/#comments</comments>
		<pubDate>Mon, 13 Aug 2012 03:55:28 +0000</pubDate>
		<dc:creator><![CDATA[Max]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[bottle]]></category>
		<category><![CDATA[bottlepy]]></category>
		<category><![CDATA[framework]]></category>
		<category><![CDATA[micro-framework]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=1660</guid>
		<description><![CDATA[On a tous plein d'idées, et souvent des idées de petits sites qu'on aimerait réaliser dans la nuit, sans se faire chier, et si possible que quand on revient dans 3 mois on sache s'y retrouver. Bottle est là pour vous, vos prières ont été exhaussées, Amen...]]></description>
				<content:encoded><![CDATA[<p>Aller bande de feignasses c&#8217;est Lundi on oublie la murge du week-end et on se secoue les neuronnes !</p>
<p><a href="http://bottlepy.org/">Bottle</a> est un micro-framework python sur lequel Sam m&#8217;a obligé de bosser après Django, (il me force à évoluer c&#8217;est une horreur). Je dois dire que je le regrette pas car c&#8217;est diablement efficace, mignon et tout et tout.</p>
<p>En début de semaine je me suis dit qu&#8217;il fallait que j&#8217;en parle, je vais donc vous montrer comment on peut développer un &#8220;site&#8221; simple en 5 minutes structuré et sans se prendre le choux. Sam viendra compléter mes oublis.</p>
<p>Je ne vais pas aborder la base de données mais il y a plein de <a href="http://bottlepy.org/docs/dev/plugins/index.html">plugins bottle ici</a> dont un ORM pour sqlite qu&#8217;on détaillera dans un article le jour où on s&#8217;en servira ;)</p>
<p>Avant de commencer: Pourquoi je l&#8217;aime ?</p>
<ul>
<li>Simple à comprendre</li>
<li>bien structuré (des vues des templates, un routing clair)</li>
<li>gestion des urls fastoches</li>
<li>un petit serveur web intégré, on démarre son site en 10 secondes et on debug avec <a href="http://sametmax.com/debugger-en-python-les-bases-de-pdb/" >ipdb</a></li>
<li>une <a href="http://bottlepy.org/docs/dev/tutorial.html#quickstart-hello-world">doc</a> formidabuleuse avec des exemples concrets</li>
<li>il cracke les watts</li>
</ul>
<p><b>En route simone !</b></p>
<p>On prend la bite rude de créer un environnement virtuel et on fait un <code><a href="http://sametmax.com/votre-python-aime-les-pip/">pip</a> install bottl</code>e. Pour ceux qui veulent tout saloper faites juste un <code>pip install bottle,</code> pour ceux qui savent pas ce qu&#8217;est &#8220;pip&#8221; faites un &#8220;wget http://bottlepy.org/bottle.py&#8221; dans le dossier de votre projet.</p>
<p><b>je veux que ça marche tout de suite !</b></p>
<p>Editez un fichier python start.py à la racine de votre projet et collez ça dedans:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">from</span> bottle <span style="color: #ff7700;font-weight:bold;">import</span> Bottle<span style="color: #66cc66;">,</span> run
&nbsp;
app <span style="color: #66cc66;">=</span> Bottle<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #66cc66;">@</span>app.<span style="color: black;">route</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'/'</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">def</span> hello<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #483d8b;">&quot;Max est le plus beau!&quot;</span>
&nbsp;
run<span style="color: black;">&#40;</span>app<span style="color: #66cc66;">,</span> host<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'localhost'</span><span style="color: #66cc66;">,</span> port<span style="color: #66cc66;">=</span><span style="color: #ff4500;">8080</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>maintenant dans le shell tapez dans le dossier de votre projet où se trouve start.py:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;">python start.py 
Bottle server starting up <span style="color: #7a0874; font-weight: bold;">&#40;</span>using WSGIRefServer<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>...
Listening on http:<span style="color: #000000; font-weight: bold;">//</span>localhost:<span style="color: #000000;">8080</span><span style="color: #000000; font-weight: bold;">/</span>
Hit Ctrl-C to quit.
&nbsp;
localhost - - <span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">12</span><span style="color: #000000; font-weight: bold;">/</span>Aug<span style="color: #000000; font-weight: bold;">/</span><span style="color: #000000;">2012</span> <span style="color: #000000;">23</span>:<span style="color: #000000;">12</span>:<span style="color: #000000;">15</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> <span style="color: #ff0000;">&quot;GET / HTTP/1.1&quot;</span> <span style="color: #000000;">200</span> <span style="color: #000000;">21</span>
localhost - - <span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">12</span><span style="color: #000000; font-weight: bold;">/</span>Aug<span style="color: #000000; font-weight: bold;">/</span><span style="color: #000000;">2012</span> <span style="color: #000000;">23</span>:<span style="color: #000000;">12</span>:<span style="color: #000000;">16</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> <span style="color: #ff0000;">&quot;GET /favicon.ico HTTP/1.1&quot;</span> <span style="color: #000000;">404</span> <span style="color: #000000;">742</span></pre></td></tr></table></div>

<p>Ouvrez le navigateur Internet explorer bourré de toolbars à l&#8217;adresse <a href="http://127.0.0.1:8080">127.0.0.1:8080</a></p>
<p>C&#8217;est bon ça marche, c&#8217;est fini, vous êtes un pro du pot. Quand on voit ça on se dit que franchement ça sert à rien de se faire chier plus que ça&#8230; :)</p>
<p>Moi quand je vois ça ça me fait chialer à chaque fois tellement c&#8217;est simple, je me dis que je vais révolutionner le monde, conquérir la planète, me taper les plus belles meufs&#8230;</p>
<p>Avant d&#8217;aller plus loin je reprends le code et je note ce qu&#8217;il faut retenir</p>
<p><b>1. le routing</b></p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">@</span>app.<span style="color: black;">route</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'/'</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>@app.route(&#8216;/&#8217;) prend tout ce qui arrive à la racine de l&#8217;url et le traite dans la vue hello qui est une fonction de base toute simple. si j&#8217;avais voulu faire une url du genre 127.0.0.1:8080/samapoil j&#8217;aurais mis @app.route(&#8216;/samapoil&#8217;)</p>
<p><b>2. les vues</b></p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">def</span> hello<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #483d8b;">&quot;Max est le plus beau!&quot;</span></pre></td></tr></table></div>

<p>la vue est une fonction que l&#8217;ont défini et qui peut prendre n&#8217;importe quel nom, dedans on traite l&#8217;information qui arrivera de l&#8217;url routée par le <a href="http://sametmax.com/comprendre-les-decorateurs-python-pas-a-pas-partie-1/">décorateur</a> &#8220;@app.route(&#8216;/&#8217;)&#8221;. Cette vue peut recevoir des infos d&#8217;un formulaire ou des variables passées dans l&#8217;url (qu&#8217;on va voir plus bas)</p>
<p>Voilà votre premier site bottle marche, c&#8217;est rigolo. Maintenant on va aller un peu plus loin et utiliser les templates.</p>
<p><b>Les templates c&#8217;est quoi ?</b><br />
Les templates c&#8217;est juste du code HTML avec dedans des &#8220;variables&#8221; que l&#8217;on va peupler dans notre vue. ça sert à ne pas trop mélanger code python et html et c&#8217;est plutôt une bonne idée.</p>
<p><b>Création d&#8217;un template:</b><br />
éditez un fichier template.tpl et mettez dedans</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">&lt;</span>div <span style="color: #007800;">align</span>=<span style="color: #ff0000;">&quot;center&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span><span style="color: #7a0874; font-weight: bold;">&#123;</span><span style="color: #7a0874; font-weight: bold;">&#123;</span> title <span style="color: #7a0874; font-weight: bold;">&#125;</span><span style="color: #7a0874; font-weight: bold;">&#125;</span><span style="color: #000000; font-weight: bold;">&lt;/</span>div<span style="color: #000000; font-weight: bold;">&gt;</span></pre></td></tr></table></div>

<p><b>Maintenant on va assembler le template et la vue comme un légo:</b><br />
Ouvrez le fichier start.py et collez</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">from</span> bottle <span style="color: #ff7700;font-weight:bold;">import</span> Bottle<span style="color: #66cc66;">,</span> run<span style="color: #66cc66;">,</span> view
&nbsp;
app <span style="color: #66cc66;">=</span> Bottle<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #66cc66;">@</span>app.<span style="color: black;">route</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'/'</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">@</span>view<span style="color: black;">&#40;</span><span style="color: #483d8b;">'template.tpl'</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">def</span> hello<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
    context <span style="color: #66cc66;">=</span> <span style="color: black;">&#123;</span><span style="color: #483d8b;">'title'</span>: <span style="color: #483d8b;">&quot;Max est le plus beau&quot;</span><span style="color: black;">&#125;</span>
    <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: black;">&#40;</span>context<span style="color: black;">&#41;</span>
&nbsp;
run<span style="color: black;">&#40;</span>app<span style="color: #66cc66;">,</span> host<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'localhost'</span><span style="color: #66cc66;">,</span> port<span style="color: #66cc66;">=</span><span style="color: #ff4500;">8080</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>Relancez le serveur (python start.py) et allez sur à l&#8217;adresse <a href="http://127.0.0.1:8080/127.0.0.1:8080">127.0.0.1:8080</a></p>
<p>Et voilà notre template utilisé par notre vue auquel on a passé un title. Ceci ce fait grace au décorateur &#8220;@view&#8221; auquel on donne le chemin du template. Les templates offrent pas mal de <a href="http://bottlepy.org/docs/dev/tutorial.html#templates">possibilitées</a></p>
<p>Les bases sont posées ce n&#8217;est vraiment pas sorcier, je rajoute quelques exemples pratiques mais tout ceci figure dans la <a href="http://bottlepy.org/docs/dev/tutorial.html#quickstart-hello-world">doc</a></p>
<p><b>Mettre un id dans l&#8217;url:</b></p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;">#!/usr/bin/env python</span>
<span style="color: #808080; font-style: italic;"># -*- coding: utf-8 -*-</span>
<span style="color: #ff7700;font-weight:bold;">from</span> bottle <span style="color: #ff7700;font-weight:bold;">import</span> Bottle<span style="color: #66cc66;">,</span> run<span style="color: #66cc66;">,</span> view
app <span style="color: #66cc66;">=</span> Bottle<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #66cc66;">@</span>app.<span style="color: black;">route</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'/:mon_id'</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">@</span>view<span style="color: black;">&#40;</span><span style="color: #483d8b;">'template.tpl'</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">def</span> hello<span style="color: black;">&#40;</span>mon_id<span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot;
        Récupre la variable mon_id passée dans l'url sous la forme 127.0.0.1:8080/1 et la transmet au template via le context
    &quot;&quot;&quot;</span>
    context <span style="color: #66cc66;">=</span> <span style="color: black;">&#123;</span><span style="color: #483d8b;">'title'</span>: <span style="color: #483d8b;">&quot;Max est le plus beau %s&quot;</span> % mon_id<span style="color: black;">&#125;</span>
    <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: black;">&#40;</span>context<span style="color: black;">&#41;</span>
&nbsp;
run<span style="color: black;">&#40;</span>app<span style="color: #66cc66;">,</span> host<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'localhost'</span><span style="color: #66cc66;">,</span> port<span style="color: #66cc66;">=</span><span style="color: #ff4500;">8080</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p><b>Récupérer une variable dans l&#8217;url:</b></p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;">#!/usr/bin/env python</span>
<span style="color: #808080; font-style: italic;"># -*- coding: utf-8 -*-</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> bottle <span style="color: #ff7700;font-weight:bold;">import</span> Bottle<span style="color: #66cc66;">,</span> run<span style="color: #66cc66;">,</span> view<span style="color: #66cc66;">,</span> request
&nbsp;
app <span style="color: #66cc66;">=</span> Bottle<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #66cc66;">@</span>app.<span style="color: black;">route</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'/jemesure'</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">@</span>view<span style="color: black;">&#40;</span><span style="color: #483d8b;">'template.tpl'</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">def</span> hello<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot;
        Récupère la variable taille à l'aide de l'objet request pour l'url 
        http://127.0.0.1:8080/jemesure?taille=133
    &quot;&quot;&quot;</span>
    context <span style="color: #66cc66;">=</span> <span style="color: black;">&#123;</span><span style="color: #483d8b;">'title'</span>: <span style="color: #483d8b;">&quot;Je mesure %s cm&quot;</span> % request.<span style="color: black;">params</span>.<span style="color: black;">taille</span><span style="color: black;">&#125;</span>
    <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: black;">&#40;</span>context<span style="color: black;">&#41;</span>
&nbsp;
run<span style="color: black;">&#40;</span>app<span style="color: #66cc66;">,</span> host<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'localhost'</span><span style="color: #66cc66;">,</span> port<span style="color: #66cc66;">=</span><span style="color: #ff4500;">8080</span><span style="color: #66cc66;">,</span> reloader<span style="color: #66cc66;">=</span><span style="color: #008000;">True</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>Notez le &#8220;reloader=True&#8221; qui permet au serveur de redémarrer à chaque modif du code, hyper pratique.</p>
<p><b>Edit:</b></p>
<p><b>Servir les images, js, css (appelé contenu statique):</b></p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;">#!/usr/bin/env python</span>
<span style="color: #808080; font-style: italic;"># -*- coding: utf-8 -*-</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> bottle <span style="color: #ff7700;font-weight:bold;">import</span> Bottle<span style="color: #66cc66;">,</span> run<span style="color: #66cc66;">,</span> static_file
app <span style="color: #66cc66;">=</span> Bottle<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #66cc66;">@</span>app.<span style="color: black;">route</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'/static/&lt;filename:path&gt;'</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">def</span> server_static<span style="color: black;">&#40;</span>filename<span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot;
        Sert les fichiers statiques tel que .js, .css, .jpeg, etc...
    &quot;&quot;&quot;</span>
    <span style="color: #ff7700;font-weight:bold;">return</span> static_file<span style="color: black;">&#40;</span>filename<span style="color: #66cc66;">,</span> root<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'.'</span><span style="color: black;">&#41;</span>
&nbsp;
run<span style="color: black;">&#40;</span>app<span style="color: #66cc66;">,</span> host<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'localhost'</span><span style="color: #66cc66;">,</span> port<span style="color: #66cc66;">=</span><span style="color: #ff4500;">8080</span><span style="color: #66cc66;">,</span> reloader<span style="color: #66cc66;">=</span><span style="color: #008000;">True</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>Grace à static_file vous pourrez servir vos images, faire télécharger des fichiers, etc, simplement. Dans l&#8217;exemple ci-dessus si vous allez sur l&#8217;url <a href="http://127.0.0.1:8080/static/template.tpl">http://127.0.0.1:8080/static/template.tpl</a> vous allez télécharger le template template.tpl, si c&#8217;est une image, votre navigateur affichera une image, etc&#8230;</p>
<p>Je vous conseille d&#8217;aller voir la doc histoire de vous mettre l&#8217;eau à la bouche. JE déteste les docs en général mais là je la trouve presque parfaite.</p>
<p>Sam vous fera un article bientôt sur comment mettre tout ça en prod car le petit serveur web compris dans bottle ne peut bien sur pas assurer une charge en prod.<br />
Mais comme dit ma grand-mère ça se goupille comme un doigt au cul.</p>
<p>Bottle est vraiment pour moi l&#8217;outil parfait pour concrétiser rapidement une idée, un site qui ne demande pas une grosse structure, bref un projet qui doit se torcher rapidement ;)</p>
<p>Et pour illustrer ce que j&#8217;ai pu faire en quelques jours de taf avec bottle et un peu de Jquery je vous mettrai en ligne dans la semaine un petit site fort symphatique je pense&#8230;</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/creer-un-site-avec-bottle-en-5-minutes-parceque-7-cest-impossible-voyons/feed/</wfw:commentRss>
		<slash:comments>17</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2012/08/sancerre-comte-lafond-grande.jpeg" length="8312" type="image/jpg" />	</item>
		<item>
		<title>Schéma de fonctionnement général de Django 12</title>
		<link>http://sametmax.com/schema-de-fonctionnement-general-de-django/</link>
		<comments>http://sametmax.com/schema-de-fonctionnement-general-de-django/#comments</comments>
		<pubDate>Thu, 21 Jun 2012 21:04:42 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[Web]]></category>
		<category><![CDATA[django]]></category>
		<category><![CDATA[framework]]></category>
		<category><![CDATA[http]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=964</guid>
		<description><![CDATA[Voici une explication du fonctionnement global de Django. Comme ça la prochaine fois que vous lisez un tuto Django et qu'on demande d'insérer un blougou à sens giratoire inversé dans le convecteur temporel, vous ne saurez toujours pas de quoi on parle, mais vous saurez où ça se trouve.]]></description>
				<content:encoded><![CDATA[<p>Les frameworks Web rendent ceux qui les maitrisent très productifs, mais pour débuter, quelle galère ! On a envie de retourner à ses vieux scripts tout pourris mais bien plus facile à comprendre. Et c&#8217;est normal, on est pas la pour se toucher devant la qualité du code, mais pour obtenir un truc qu marche (dédicace à Max).</p>
<p>Voici une explication du fonctionnement global de <a href="https://www.djangoproject.com/">Django</a>. Comme ça la prochaine fois que vous lisez un tuto Django et qu&#8217;on demande d&#8217;insérer un blougou à sens giratoire inversé dans le convecteur temporel, vous ne saurez toujours pas de quoi on parle, mais vous saurez où ça se trouve.</p>
<h2>Le protocole HTTP</h2>
<p>Pour comprendre ce que fait Django, il faut piger le fonctionnement du Web. Si vous savez ce qu&#8217;est une requête POST et que la notion de headers et de cookies ne vous parait pas complètement glucose, vous pouvez sauter cette partie. Les autres, n&#8217;ayez pas honte, il y a des centaines de dev Web là dehors ne savent pas comment ça marche.</p>
<p>En résumé, se balader sur le Web, c&#8217;est comme aller au resto. On est un client, on demande quelque chose au serveur, le serveur va voir en cuisine, et revient avec la bouffe, ou une explication sur l&#8217;absence de la bouffe (mais jamais pourquoi la bouffe est dégueulasse, allez comprendre):</p>
<div id="attachment_965" style="width: 533px" class="wp-caption aligncenter"><a href="http://sametmax.com/wp-content/uploads/2012/06/http.png" class="grouped_elements" rel="tc-fancybox-group964"><img class=" wp-image-965 " title="Le protocole HTTP, en gros" src="http://sametmax.com/wp-content/uploads/2012/06/http.png" alt="Schéma du protocole HTTP, en gros" width="523" height="666" /></a><p class="wp-caption-text">Le protocole HTTP, en (très) gros</p></div>
<p>Ce cycle requête/réponse se déroule des centaines de fois quand on parcours un site Web. Chaque lien cliqué déclenche une requête GET, et la page suivante ne s&#8217;affiche que parcequ&#8217;on a reçu la réponse contenant le HTML de celle-ci. Les formulaires, les requêtes AJAX, la mise à jour de vos Tweets sur votre téléphone, tout ça fonctionne sur le même principe.</p>
<h2>Django dans tout ce merdier</h2>
<p>Django est un framework Web, le serveur lui fait passer chaque requête GET, POST (ou autres) envoyée par les clients. Django, lui, génère un contenu pour chacune d&#8217;elle (souvent du HTML), et le refile au serveur qui renvoit la réponse au client. En détail, ça donne ça:</p>
<div id="attachment_966" style="width: 457px" class="wp-caption aligncenter"><a href="http://sametmax.com/wp-content/uploads/2012/06/django.png" class="grouped_elements" rel="tc-fancybox-group964"><img class=" wp-image-966  " title="Le cycle de vie d'une requête traitée par Django" src="http://sametmax.com/wp-content/uploads/2012/06/django.png" alt="Schéma du cycle de vie d'une requête traitée par Django" width="447" height="633" /></a><p class="wp-caption-text">Le cycle de vie d&#39;une requête traitée par Django</p></div>
<p>Django ce n&#8217;est que ça. Il n&#8217;y a rien de mystérieux: la requête arrive, on prend un template, on dit à Django de mettre des données récupérées depuis la base de données dans le template, on génére du HTML, on retourne la réponse. Le reste (le gros reste), ce sont juste des outils pour automatiser toutes les variantes de ce cycle: formulaire, flux RSS, gestion de droits, etc. Mais tout tourne TOUJOURS autour de la logique requête/réponse car le but est de faire du Web, et que le Web marche comme cela.</p>
<h2>Vocabulaire</h2>
<p>La difficulté de Django vient aussi du vocabulaire car on utilise des mots compliqués pour désigner des trucs simples.</p>
<p><strong>Urlresolvers</strong>: la partie de Django qui reçoit la requête, la compare à une route dans <em>urls.py</em>, et appelle la bonne vue de <em>views.py</em><br />
<strong>Template processor</strong>: la partie de Django qui permet de récupérer un template par son nom, de lui passer des données, et de récupérer du HTML sans se fouler. On l&#8217;utilise rarement directement, généralement on passe plutôt par une fonction raccourcie comme <em>render()</em>.<br />
<strong>Template Context</strong>: un simple dictionnaire dont les clés sont les noms des variables qu&#8217;on veut rendre disponibles dans un template, et les valeurs sont les valeurs de ces variables. On créé ce dictionnaire dans un vue, et on le passe au template processor pour obtenir du HTML à partir d&#8217;un template.<br />
<strong>Tags et filters</strong>: des fonctions Python castrées pour pouvoir être utilisées dans un template (puisque le template est là pour limiter l&#8217;usage de fonctions dans le HTML)</p>
<p>Vous avez dû noter des asterisques sur le schéma de fonctionnement de Django. Ce sont les endroits où agissent deux parties de Django particulièrement mal comprises:</p>
<p><strong>* Middleware</strong>: un nom pompeux pour dire &#8220;<em>Une classe Python normale avec une methode appelée à chaque requête, et une méthode appelée à chaque réponse</em>.&#8221; En gros, c&#8217;est votre moyen d&#8217;appliquer un traitement à toutes les requêtes ou les réponses. Par exemple si vous voulez rediriger tous les mobiles vers une version mobile d&#8217;un site, vous faite une classe dont une méthode vérifie le contenu de chaque requête, regarde si le Header &#8220;User-Agent&#8221; est un mobile, et court-circuite la réponse pour rediriger immédiatement. Il suffit de déclarer cette classe comme middleware dans le fichier <em>settings.py</em> et ça marche tout seul.<br />
<strong>** Context processor</strong>: un nom pompeux pour dire &#8220;<em>Une fonction Python normale qui accepte un Template Context (un simple dictionaire) en entrée, et qui le retourne modifié.</em>&#8221; On l&#8217;utilise quand on veut qu&#8217;une valeur soit disponible dans tous les templates, par exemple en rajoutant la date du jour dans le Template Context.</p>
<p>C&#8217;est tout. Vraiment, c&#8217;est tout. Le reste c&#8217;est du bonus. Django c&#8217;est juste ça.</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/schema-de-fonctionnement-general-de-django/feed/</wfw:commentRss>
		<slash:comments>12</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2012/06/vous-etes-ici-3.gif" length="8970" type="image/jpg" />	</item>
	</channel>
</rss>
